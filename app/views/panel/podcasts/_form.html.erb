<link rel="stylesheet" href="/assets/libraries/fontawesome/css/all.min.css">
<form id="fields-for-s3">
	<% @s3_direct_post.fields.map do |name, value| %>
	    <input type="hidden" name="<%= name %>" value="<%= value %>" />
	<% end %>
</form>
<%= form_for [:panel, @station, @podcast], multipart: true, authenticity_token: true, html: { class: "card admin-form directUpload", remote: true, data: { 'form-data' => (@s3_direct_post.fields), 'url' => @s3_direct_post.url, 'host' => URI.parse(@s3_direct_post.url).host }} do |f| %>
	<% if @podcast.errors.any? %>
		<h5 class="small-title"><%= pluralize(@podcast.errors.count, "errores") %></h5>
			<ul class="errors">
				<% @podcast.errors.full_messages.each do |msg| %>
						<li><%= msg %></li>
				<% end %>
			</ul>
	<% end %>

	<div class="field field--string">
		<label>Nombre del Podcast: </label>
		<%= f.text_field :name %>
	</div>
	<div class="field field--string">
		<label>Descripci√≥n: </label>
		<%= f.text_area :description %>
	</div>
	<div class="field field--string">
		<label>Archivo del stream: <i class="icon-uploading fas fa-spinner fa-spin"></i></label>
		<!--< %= f.file_field :stream_url %>-->
    <input type="file" id="awsS3File" accept="audio/*">
		<%= f.text_field :stream_url %>
	</div>

<% end %>
<%#= render "components/s3_form_js" %>
<script src="/assets/libraries/js/podcastUpload.js"></script>
<script type="text/javascript" charset="utf-8">
    $(document).ready(() => {
        const iconUploading = $(`.icon-uploading`);
        iconUploading.hide();
        $(`#awsS3File`).on('change', (event) => {
            const files = event.target.files;
            if (files.length > 0 ) {
                iconUploading.show();
                uploadAWSS3(files[0]).subscribe(urlPath => {
                    iconUploading.hide();
                    $('#podcast_stream_url').val(urlPath);
                }, error => {
                    iconUploading.hide();
                });
            }
        });
    });
</script>

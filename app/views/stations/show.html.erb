<% content_for :title, @station.name  %>
<link href="http://vjs.zencdn.net/6.0.0/video-js.css" rel="stylesheet">

<script src="//vjs.zencdn.net/6.0.0/video.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/videojs-contrib-hls/5.8.2/videojs-contrib-hls.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/swfobject/2.2/swfobject.js"></script>
<!-- <script src="https://vjs.zencdn.net/6.2.7/video.js" ></script>			 -->
<!-- <script src="https://unpkg.com/videojs-flash/dist/videojs-flash.js" ></script> -->
<script src="//code.jquery.com/jquery-1.12.4.min.js"></script>
<!-- <link rel="stylesheet" href="//releases.flowplayer.org/7.1.2/skin/skin.css">
<script src="//releases.flowplayer.org/7.1.2/flowplayer.min.js"></script>
<script src="//releases.flowplayer.org/hlsjs/flowplayer.hlsjs.light.min.js"></script> -->
	<h1 data-chrome class="station__name">Si tu video no se ve correctamente, da click <a href="#">aquí</a></h1>

<% if @station.news == false %>
	<div class="interface--row">
		<div class="main-content station">
			<div class="station__header">
				<%= image_tag @station.image, class: "station__image" %>

				<div class="header__info">
					<h4 class="station__name"><%= @station.name %></h4>

					<p class="station__description"><%= @station.description %></p>
					<div class="social-media" data-article="<%= station_url(@station) %>">
						<%= link_to ("whatsapp://send?text=" + station_url(@station)), class: "social-media__link whatsapp", target: "_blank" do %>
							<%= image_tag "whatsapp.svg" %>
						<% end %>
						<a class="social-media__link facebook" target="_blank" onclick="shareToFacebook(event);">
							<%= image_tag "facebook.svg" %>				
						</a>	
						<a target="_blank" href="https://twitter.com/home?status=<%= truncate(@station.name, length: 80) %>%20%2D%20<%= url_encode(station_url(@station)) %>" class="social-media__link twitter">
							<%= image_tag "twitter.svg" %>
						</a>
						<a class="social-media__link copy" target="_self" data-clipboard-text="<%= station_url(@station) %>">	
							<input class="hidden" value="<%= station_url(@station) %>">
							<%= image_tag "copy.svg" %>
						</a> 
					</div>
		
				</div>
			</div>

			<% if !@station.video? and !@station.news? %>
				<audio controls autoplay id="audio" controlsList="nodownload">
					<source src="<%= @station.stream_url %>" type="audio/mpeg">	
				</audio>

				

				<!-- <div class="flowplayer" data-rtmp="<%= @rtmps_src %>" style="height: 70px;">
				<video controls autoplay >
				    <source type="application/x-mpegurl" src="<%= @https_src %>">
				    <source type="video/flash" src="<%= @rtmps_src %>">
				</video>
				</div> -->
	
 			<!-- <video id="video" class="video-js" controls  preload="auto" width="640" height="264">
				  		
						<source src="<%= @https_src %>" type="application/x-mpegURL">

						<source src="<%= @rtmps_src %>" type="video/flash">
				  </video> -->
			<% else %>	

<div style="height:264px; width:640px; background:#000000">
<style>.video-js .vjs-time-control{display: none;}.video-js .vjs-progress-control{display: none;}</style>
<video id="player_webtv" class="video-js vjs-big-play-centered vjs-fluid" autoplay  controls preload="auto" width="100%" height="100%" data-setup="{ 'fluid':true,'aspectRatio':'16:9' }" >
   <source src="http://mediacp.live:1935/8258/8258/playlist.m3u8" type="application/x-mpegURL">
</video>

<script>var myPlayer=videojs('player_webtv',{},function(){var player=this;player.on("pause",function(){player.one("play",function(){player.load();player.play();});});})</script>
</div>
					
					
			<% end %>	
			<div class="program__info">
				
				<% if @timetables.first %>
					<%= image_tag @timetables.first.broadcaster_image, class: "station__broadcaster-image" %>
					<div class="program__info__text">
						<p><%= @timetables.first.name %></p>						
						<p><%= @timetables.first.description %></p>
						<p class="radio-banner__tune-in">Con:</p>
						<p><%= @timetables.first.broadcasters %></p>
					</div>
				<% end %>
			</div>
			<div class="station__info">		

				<div class="station__programs">
					<% @timetables.each_with_index do |timetable, index| %>
						<% if index == 0 and @station.video == false %>
							<p class="program__current-indicator">Suena Ahora:</p>
						<% elsif index == 0 and @station.video == true %>
							<p class="program__current-indicator">Programa actual:</p>
						<% end %>
						<div class="program">
							
							<p class="program__hour"><%= timetable.streaming_hour.strftime('%H:%M') %></p>	 
							<p class="program__name"><%= timetable.name %></p>		 
						</div>
					<% end %>	
				</div>

			</div>

		<% if @station.playlist_1 != "" %>
			<div class="radio-banner__tune-in">Playlists recomendadas para ti</div>
			<div class="playlists">
				<% if @station.playlist_1 != "" %>
					<a target="_blank" href="<%= @station.playlist_1 %>" class="playlist">
						<%= image_tag @station.playlist_1_image %>
					</a>
				<% end %>
				<% if @station.playlist_2 != "" %>
					<a target="_blank" href="<%= @station.playlist_2 %>" class="playlist">
						<%= image_tag @station.playlist_2_image %>
					</a>
				<% end %>
				<% if @station.playlist_3 != "" %>
					<a target="_blank" href="<%= @station.playlist_3 %>" class="playlist">
						<%= image_tag @station.playlist_3_image %>
					</a>
				<% end %>
				<% if @station.playlist_4 != "" %>
					<a target="_blank" href="<%= @station.playlist_4 %>" class="playlist">
						<%= image_tag @station.playlist_4_image %>
					</a>
				<% end %>
			</div>
		<% end	%>
			<div class="radio-banner__tune-in">También puedes disfrutar</div>
			<div class="station__recommendations">
				<% @recommendations.each do |recommendation| %>
					<%= link_to recommendation, class: "recommendation__image" do %>
						<%= image_tag recommendation.image %>
					<% end %>
				<% end %>
			</div>
			<% if @station.article_relationships.count > 0 %>
				<div class="radio-banner__tune-in">Lo más reciente</div>

				<div class="station__articles">
					<% @station.article_relationships.order(created_at: :desc).first(3).each do |relationship| %>
							<%= render "components/horizontal-note", article: relationship.article %>
					<% end %>
				
					<!-- VÏNCULO PARA VER MAS -->
					<% if @station.article_relationships.count > 3 %>
						<%= link_to "Ver más notas", station_articles_path(@station.slug), class: "view-more" %>		
					<% end %>
				</div>
			<% end %>
			<% if get_banner(@station, "Station", "Grande").count > 0 %>
				<%= render "components/big-banner", banner: get_banner(@station, "Station", "Grande" ) %>
			<% end %>
		</div>

		<%= render "components/stations-sidebar", facebook: @station.facebook, twitter: @station.twitter %>

	</div>
<% else %>


	<%= render "news-station", station: @station, timetables: @timetables %>
<% end %>

<script type="text/javascript">
	$('[data-chrome]').hide();

	function requestFlashPermission() {
	    var iframe = document.createElement('iframe');
	    iframe.src = 'https://get.adobe.com/flashplayer';
	    iframe.sandbox = '';
	    document.body.appendChild(iframe);
	    document.body.removeChild(iframe);
	}


	var isNewChrome = (navigator.userAgent.match(/Chrom(e|ium)\/(\d+)/) || [])[2] > 56
	    && !/Mobile/i.test(navigator.userAgent);
	    var isNewFirefox = (navigator.userAgent.match(/Fireforx\/(\d+)/));
	    
	var canRequestPermission =  isNewChrome;

	if (!swfobject.hasFlashPlayerVersion('10') && canRequestPermission) {
		$('[data-chrome]').show();
	    requestFlashPermission();
	    // Chrome requires user's click in order to allow iframe embeding
	    $(window).one('click', requestFlashPermission);	
	}


</script>
